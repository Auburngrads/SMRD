---
title: "`r SMRD2:::info('book')`"
subtitle: "`r SMRD2:::info('chapter23')`"
author: "`r SMRD2:::info('authors')`"
date: "`r Sys.Date()`"
output: 
  rmarkdown::html_vignette:
    css: my-vignette.css
    fig_caption: yes
vignette: >
  %\VignetteIndexEntry{echapter23}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, echo=FALSE}
SMRD2:::vinny()
library(SMRD2)
```

# In This Vignette...


##	Nelson's Insulation Breakdown degradation data

```{r}
## create the ddd data object

InsulationBrkdwn.ddd <- frame.to.ddd(insulationbrkdwn,
                                     response.column = 3, 
                                     time.column = 1,
                                     x.columns = 2,
                                     data.title = "Voltage Breakdown Data",
                                     response.units = "Volts",
                                     time.units = "Weeks")

print(InsulationBrkdwn.ddd)
```


Plot the data

```{r}
plot(InsulationBrkdwn.ddd,
     transformation.Response = "log",
     transformation.time = "linear")

tmp <- groupi.Dest.Degrad.indivplots(InsulationBrkdwn.ddd,
                                     transformation.Response = "log", 
                                     transformation.time = "linear",
                                     distribution = "normal")

groupi.Dest.Degrad.oneplot(InsulationBrkdwn.ddd,
                           transformation.Response = "log", 
                           transformation.time = "linear",
                           distribution="normal")
```

Fit model using Nelson's parameterization and base 10 logs

```{r}
groupm.Dest.Degrad(InsulationBrkdwn.ddd, distribution = "normal",
                   transformation.Response = "log10",
                   transformation.x = "invtemp",
                   transformation.time = "linear")


groupm.Dest.Degrad(InsulationBrkdwn.ddd, distribution = "normal",
                   transformation.Response = "log",
                   transformation.x = "arrhenius",
                   transformation.time="linear")
```

Do individual analyses at each level of temperature

```{r}
InsulationBrkdwn.groupi.Dest.Degrad <-groupi.Dest.Degrad(InsulationBrkdwn.ddd,
                                                         distribution = "normal",
                                                         transformation.Response = "log", 
                                                         transformation.time = "sqrt")


plot(InsulationBrkdwn.groupi.Dest.Degrad,
     transformation.x = "Arrhenius")
```

Fit the arrhenius model; specify new data

```{r}
InsulationBrkdwn.groupm.Dest.Degrad <-groupm.Dest.Degrad(InsulationBrkdwn.ddd,
                                                         distribution = "normal", 
                                                         transformation.Response = "log",
                                                         transformation.x = "arrhenius", 
                                                         transformation.time = "sqrt")

InsulationBrkdwn.groupm.Dest.Degrad<-groupm.Dest.Degrad(InsulationBrkdwn.ddd,
                                                        distribution = "normal",
                                                        transformation.Response = "log",
                                                        transformation.x = "arrhenius",
                                                        transformation.time = "sqrt",
                                                        new.data = c("150,260"))


residual.plots(InsulationBrkdwn.groupm.Dest.Degrad)
```

Plot the failure time distribution for given failure levels

```{r}
plot.groupm.Dest.Degrad.out(InsulationBrkdwn.groupm.Dest.Degrad,
                            FailLevel = 2)

quantiles.groupm.Dest.Degrad.out(InsulationBrkdwn.groupm.Dest.Degrad,
                                 FailLevel = 10, 
                                 use.condition = 150)

quantiles.groupm.Dest.Degrad.out(InsulationBrkdwn.groupm.Dest.Degrad,
                                 FailLevel = 10, 
                                 use.condition = 150,
                                 prob = 0.2)

quantiles.groupm.Dest.Degrad.out(InsulationBrkdwn.groupm.Dest.Degrad,
                                 FailLevel = 2,
                                 use.condition = 150)

failure.probabilities.groupm.Dest.Degrad.out(InsulationBrkdwn.groupm.Dest.Degrad,
                                             FailLevel = 2,
                                             use.condition = 150, 
                                             time.vec = seq(6000,8000, by = 200))
```


## Adhesive Strength example ignoring the groups

This is a really messy set of data with slopes going in the wrong direction for some temps

```{r}
AdhesiveStrength.ddd <- frame.to.ddd(adhesivestrength, 
                                     response.column = "pounds",
                                     time.column = "days",
                                     x.columns = "celsius",
                                     data.title = "AdhesiveStrength Strength Data",
                                     time.units = "Days")

AdhesiveStrength.gmle <- dest.degrad.mle(AdhesiveStrength.ddd,
                                         distribution = "normal",
                                         transformation.response = "log", 
                                         transformation.x = "arrhenius", 
                                         transformation.time = "linear")

get.sub.model.dest.degrad.mle.out(AdhesiveStrength.gmle,c(50,60,70))

plot.Dest.Degrad.data(AdhesiveStrength.ddd,
                      transformation.Response = "linear")

plot.Dest.Degrad.data(AdhesiveStrength.ddd,
                      transformation.Response = "log",
                      transformation.time = "sqrt")


AdhesiveStrength.groupi <- groupi.Dest.Degrad(AdhesiveStrength.ddd,
                                              transformation.Response = "log",
                                              transformation.time = "sqrt",
                                              distribution = "normal")

AdhesiveStrength.groupi <- groupi.Dest.Degrad(AdhesiveStrength.ddd,
                                              transformation.Response = "log",
                                              transformation.time = "sqrt",
                                              distribution = "normal",
                                              sep = T)

plot.groupi.Dest.Degrad.out(AdhesiveStrength.groupi,
                            transformation.x = "Arrhenius")

AdhesiveStrength.groupm <-  groupm.Dest.Degrad(AdhesiveStrength.ddd,
                                               distribution = "normal",
                                               transformation.Response = "log", 
                                               transformation.x = "Arrhenius", 
                                               transformation.time = "sqrt")
```

##	Test using Nelson's Insulation Breakdown degradation data times 100

This is used to compare with asym variances

```{r}
## create the dd data object

InsulationBrkdwn.test.ddd <- frame.to.ddd(insulationbrkdwn,
                                          response.column = 3, 
                                          time.column = 1, 
                                          x.columns = 2,
                                          data.title = "Voltage Breakdown Data",
                                          response.units = "Volts",
                                          time.units = "Weeks")

print(InsulationBrkdwn.test.ddd)
```

```{r}
## plot the data

plot(InsulationBrkdwn.test.ddd,
     transformation.Response = "log",
     transformation.time = "linear")
```

Compare with Wayne Nelson's parameterization.  Plots of voltage versus weeks will be the same, but coefficients depend on transformation details shown in the title

```{r}
plot.Dest.Degrad.data(InsulationBrkdwn.test.ddd,
                      transformation.Response = "log10")


InsulationBrkdwn.groupi.Dest.Degrad <-groupi.Dest.Degrad(InsulationBrkdwn.test.ddd,
                                                         distribution = "normal",
                                                         transformation.Response = "log10",
                                                         transformation.time="linear")

plot(InsulationBrkdwn.groupi.Dest.Degrad,
     transformation.x = "arrhenius")
plot(InsulationBrkdwn.groupi.Dest.Degrad,
     transformation.x = "invtemp")

InsulationBrkdwn.groupi.Dest.Degrad <-groupi.Dest.Degrad(InsulationBrkdwn.test.ddd,
                                                         distribution = "normal",
                                                         transformation.Response = "log", 
                                                         transformation.time = "linear")

plot(InsulationBrkdwn.groupi.Dest.Degrad,
     transformation.x = "arrhenius")

plot(InsulationBrkdwn.groupi.Dest.Degrad,
     transformation.x = "invtemp")

tmp10 <- groupm.Dest.Degrad(InsulationBrkdwn.test.ddd,
                            distribution = "normal",
                            transformation.Response = "log10",
                            transformation.x = "invtemp",
                            transformation.time = "linear")

tmp <- groupm.Dest.Degrad(InsulationBrkdwn.test.ddd, distribution = "normal",
                          transformation.Response = "log",
                          transformation.x = "arrhenius",
                          transformation.time = "linear")

plot.groupm.Dest.Degrad.out(tmp,FailLevel = 10)
```

Fit model using Wayne Nelson's parameterization and base 10 logs

```{r}
dest.degrad.mle(InsulationBrkdwn.test.ddd, distribution = "normal",
                transformation.Response = "log10",
                transformation.x = "invtemp",
                transformation.time = "linear")
```

Do individual analyses at each level of temperature

```{r}
InsulationBrkdwn.test.groupi.Dest.Degrad <-groupi.Dest.Degrad(InsulationBrkdwn.test.ddd,
                                                              transformation.Response = "log",
                                                              transformation.time = "sqrt",
                                                              distribution = "normal")

## print.default(attr(InsulationBrkdwn.test.groupi.Dest.Degrad.out, "data.ddd"))

plot(InsulationBrkdwn.test.groupi.Dest.Degrad.out,
     transformation.x = "Arrhenius")
```

Fit the arrhenius model; specify new data

```{r}
InsulationBrkdwn.test.groupm.Dest.Degrad.out <-groupm.Dest.Degrad(InsulationBrkdwn.test.ddd,
                                                                  distribution = "normal", 
                                                                  transformation.Response = "log",
                                                                  transformation.x = "arrhenius", 
                                                                  transformation.time = "linear",
                                                                  new.data = c("150,200,260"))
```

Plot the failure time distribution for given failure levels

```{r}
plot.groupm.Dest.Degrad.out(InsulationBrkdwn.test.groupm.Dest.Degrad.out,
                            FailLevel = 2)

plot.groupm.Dest.Degrad.out(InsulationBrkdwn.test.groupm.Dest.Degrad.out,
                            FailLevel = 10)

quantiles.groupm.Dest.Degrad.out(InsulationBrkdwn.test.groupm.Dest.Degrad.out,
                                 FailLevel = 10, 
                                 use.condition = 150)

quantiles.groupm.Dest.Degrad.out(InsulationBrkdwn.test.groupm.Dest.Degrad.out,
                                 FailLevel = 10, 
                                 use.condition = 150,
                                 prob = 0.2)


quantiles.groupm.Dest.Degrad.out(InsulationBrkdwn.test.groupm.Dest.Degrad.out,
                                 FailLevel = 2, 
                                 use.condition = 150)

failure.probabilities.groupm.Dest.Degrad.out(InsulationBrkdwn.test.groupm.Dest.Degrad.out,
                                             FailLevel = 2, 
                                             use.condition = 150,
                                             time.vec = c(300000,350000))

failure.probabilities.groupm.Dest.Degrad.out(InsulationBrkdwn.test.groupm.Dest.Degrad.out,
                                             FailLevel = 2, 
                                             use.condition = 150)

res <- c(-0.005080116, -0.008051072, -0.015674764)
```

## two variable example 

```{r}
AdhesiveBondC.ddd <- frame.to.ddd(adhesivebondc,
                                  response.column = "Pounds", 
                                  x.columns = c("DegreesC","RH"),
                                  time.column = "Days")


plot.Dest.Degrad.data(AdhesiveBondC.ddd,
                      transformation.Response = "log",
                      transformation.time = "Square root")
```

Plot both; multipleplot

```{r}
tmp <-groupi.Dest.Degrad.indivplots(AdhesiveBondC.ddd,
                                    transformation.Response = "log",
                                    transformation.time = "linear",
                                    distribution = "normal")
```

Plot both; single plot

```{r}
groupi.Dest.Degrad.oneplot(AdhesiveBondC.ddd,
                           transformation.Response = "log", 
                           transformation.time = "linear",
                           distribution = "normal")
```

Single plot

```{r}
AdhesiveBondC.groupi.Dest.Degrad.out <-groupi.Dest.Degrad(AdhesiveBondC.ddd,
                                                          distribution = "normal",
                                                          transformation.Response = "log", 
                                                          transformation.time = "sqrt")

plot.groupi.Dest.Degrad.out(AdhesiveBondC.groupi.Dest.Degrad.out,
                            transformation.x = "Arrhenius")

plot.groupi.Dest.Degrad.out(AdhesiveBondC.groupi.Dest.Degrad.out,
                            transformation.x = "Humidity",
                            focus.variable = 2)

## or more simply
plot(AdhesiveBondC.groupi.Dest.Degrad.out,
     transformation.x = "Arrhenius")

plot(AdhesiveBondC.groupi.Dest.Degrad.out,
     transformation.x = "Arrhenius")

AdhesiveBondC.groupm.Dest.Degrad.out <-groupm.Dest.Degrad(AdhesiveBondC.ddd,
                                                          distribution = "normal", 
                                                          transformation.Response = "log",
                                                          transformation.x =  c( "Arrhenius","humidity") , 
                                                          transformation.time = "linear")

AdhesiveBondC.groupm.Dest.Degrad.out <-groupm.Dest.Degrad(AdhesiveBondC.ddd,
                                                          distribution = "normal", 
                                                          transformation.Response = "log",
                                                          transformation.x =  c( "Arrhenius","humidity") , 
                                                          transformation.time = "linear",
                                                          new.data = c("25;30"),
                                                          FailLevel = 2.4)

AdhesiveBondC.groupm.Dest.Degrad.out <-groupm.Dest.Degrad(data.ddd=AdhesiveBondC.ddd,
                                                          distribution = "Normal",
                                                          transformation.Response = "Log",
                                                          transformation.time = "Linear",
                                                          transformation.x = c("Arrhenius", "Humidity"),
                                                          FailLevel = 2.4,
                                                          power = numeric(0),
                                                          PlotFailDefLine = T,
                                                          subset = T,
                                                          new.data="25;30,30;30")

plot.groupm.Dest.Degrad.out(AdhesiveBondC.groupm.Dest.Degrad.out, 
                            FailLevel = 2.4)

quantiles.groupm.Dest.Degrad.out(AdhesiveBondC.groupm.Dest.Degrad.out,
                                 FailLevel = 2.4, 
                                 use.condition = c("25;30"))

failure.probabilities.groupm.Dest.Degrad.out(AdhesiveBondC.groupm.Dest.Degrad.out,
                                             FailLevel = 2.4, 
                                             use.condition = c("25;30"),
                                             time.vec = c(2500,4000))
```
